apiVersion: install.istio.io/v1alpha3
kind: IstioControlPlane
spec:
  # Use the default profile as the base
  # More details at: https://istio.io/docs/setup/additional-setup/config-profiles/
  profile: default
  values:
    sidecarInjectorWebhook:
      rewriteAppHTTPProbe: true
    global:
      # Ensure that the Istio pods are only scheduled to run on Linux nodes
      defaultNodeSelector:
        beta.kubernetes.io/os: linux
      # Enable mutual TLS for the control plane
      controlPlaneSecurityEnabled: true
      mtls:
        # Require all service to service communication to have mtls
        enabled: true
      outboundTrafficPolicy:
        mode: REGISTRY_ONLY
      k8sIngress:
        enabled: true
        enableHttps: true
        gatewayName: ingressgateway

    gateways:
      istio-ingressgateway:
        sds:
          enabled: true
        loadBalancerIP: 51.132.30.131
        serviceAnnotations:
          service.beta.kubernetes.io/azure-load-balancer-resource-group: adazr-rg-1001
