apiVersion: apps/v1
kind: Deployment
metadata:
  name: doc-index-updater
spec:
  replicas: 1
  template:
    spec:
      containers:
        - name: doc-index-updater
          image: mhraproductsnonprodregistry.azurecr.io/products/doc-index-updater
          volumeMounts:
            - name: sftp_keys
              mountPath: "/etc/.ssh"
              readOnly: true
          env:
            - name: REDIS_SERVER
              value: doc-index-updater-non-prod.redis.cache.windows.net
            - name: SERVICE_BUS_NAMESPACE
              value: doc-index-updater-non-prod
            - name: SEARCH_SERVICE
              value: mhraproductsnonprod
            - name: RUST_LOG
              value: doc_index_updater=debug,info
            - name: SENTINEL_PRIVATE_KEY_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: sentinel-creds
                  key: private_key_password
            - name: SENTINEL_PUB_KEY_PATH
              value: /etc/.ssh/id_rsa.pub
            - name: SENTINEL_PRIVATE_KEY_PATH
              value: /etc/.ssh/id_rsa
      volumes:
        - name: sftp_keys
          secret:
            secretName: sentinel-creds
            items:
              - key: public_key
                path: id_rsa.pub
              - key: private_key
                path: id_rsa
